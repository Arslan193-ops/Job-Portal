@model Job_Portal.Models.Job

@{
    ViewData["Title"] = "Job Details";
    var role = Context.Session.GetString("UserRole");
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="card shadow-lg p-4 mt-4">
    <h2 class="text-center text-primary mb-4">Job Details</h2>
    <hr />

    <dl class="row mb-4">
        <dt class="col-sm-3 fw-bold">@Html.DisplayNameFor(model => model.Title)</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Title)</dd>

        <dt class="col-sm-3 fw-bold">@Html.DisplayNameFor(model => model.Description)</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Description)</dd>

        <dt class="col-sm-3 fw-bold">@Html.DisplayNameFor(model => model.Location)</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Location)</dd>

        <dt class="col-sm-3 fw-bold">@Html.DisplayNameFor(model => model.PostedDate)</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.PostedDate)</dd>

        <dt class="col-sm-3 fw-bold">@Html.DisplayNameFor(model => model.Employer)</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Employer.Name)</dd>
    </dl>

    <div class="d-flex justify-content-between">
        @if (role == "Employer")
        {
            <div>
                <a asp-action="Edit" asp-route-id="@Model?.JobId" class="btn btn-warning me-2">Edit</a>
                <a asp-controller="Users" asp-action="EmployerDashboard" class="btn btn-secondary">Back to List</a>
            </div>
        }
        else if (role == "JobSeeker")
        {
            var userEmail = Context.Session.GetString("UserEmail");
            var alreadyApplied = !string.IsNullOrEmpty(userEmail) &&
            Model.Applications.Any(a => a.User.Email == userEmail);

            <div>
                @if (alreadyApplied)
                {
                    <span class="badge bg-success p-2">Already Applied</span>
                }
                else
                {
                    <a asp-controller="Applications" asp-action="Create" asp-route-jobId="@Model.JobId"
                       class="btn btn-primary me-2">Apply</a>
                }
                <a asp-controller="Users" asp-action="JobSeekerDashboard" class="btn btn-secondary">Back to Dashboard</a>
            </div>
        }
    </div>
</div>
